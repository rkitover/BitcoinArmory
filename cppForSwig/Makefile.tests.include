# Makefile .include for Bitcoin Armory - Armory tests

# Here are some general notes to explain various code design issues.
#
# - For whatever reasons, user variables with underscores (e.g., LWS_LDFLAGS)
#   leads to complaints about GNU extensions. Use variables without underscores.
# - A lot of the libraries in LDADD/LIBADD aren't actually required by the
#   binaries. They're required by the linked libraries. Be sure to include them
#   in any new binaries.

# "#include <tr1/tuple>" causes a build error on macOS without this flag.
if BUILD_DARWIN
AM_CXXFLAGS += -DGTEST_USE_OWN_TR1_TUPLE=1
endif

# Standard gtest library
lib_LTLIBRARIES += gtest/libgtest.la
gtest_libgtest_la_CXXFLAGS = $(AM_CXXFLAGS) $(LIBBTC_FLAGS)
gtest_libgtest_la_CPPFLAGS = $(AM_CPPFLAGS) $(INCLUDE_FILES)
gtest_libgtest_la_SOURCES = gtest/TestUtils.cpp gtest/gtest-all.cc
gtest_libgtest_la_LIBADD = $(LIBARMORYCOMMON) $(LIBARMORYCLI) \
				$(LIBCRYPTOPP) \
				$(LIBBTC)
gtest_libgtest_la_LDFLAGS = $(AM_LDFLAGS) $(LWSLDFLAGS) $(LDFLAGS)

# ContainerTests
bin_PROGRAMS += gtest/ContainerTests
gtest_ContainerTests_SOURCES = gtest/ContainerTests.cpp
gtest_ContainerTests_CXXFLAGS = $(AM_CXXFLAGS) $(LIBBTC_FLAGS)
gtest_ContainerTests_CPPFLAGS = $(AM_CPPFLAGS) $(INCLUDE_FILES)
gtest_ContainerTests_LDADD = gtest/libgtest.la $(LIBARMORYCOMMON) \
		 $(LIBARMORYCLI) \
		 $(LIBCRYPTOPP) \
		 $(LIBBTC) -lprotobuf
gtest_ContainerTests_LDFLAGS = $(AM_LDFLAGS) $(LWSLDFLAGS) $(LDFLAGS) -static
TESTS += gtest/ContainerTests

# DB1kIterTest
bin_PROGRAMS += gtest/DB1kIterTest
gtest_DB1kIterTest_SOURCES = gtest/DB1kIterTest.cpp
gtest_DB1kIterTest_CXXFLAGS = $(AM_CXXFLAGS) $(LIBBTC_FLAGS)
gtest_DB1kIterTest_CPPFLAGS = $(AM_CPPFLAGS) $(INCLUDE_FILES)
gtest_DB1kIterTest_LDADD = gtest/libgtest.la $(LIBARMORYCOMMON) \
		 $(LIBARMORYCLI) \
		 $(LIBCRYPTOPP) \
		 $(LIBBTC) \
		 $(LIBLMDB) \
		 -lprotobuf
gtest_DB1kIterTest_LDFLAGS = $(AM_LDFLAGS) $(LWSLDFLAGS) $(LDFLAGS) -static
TESTS += gtest/DB1kIterTest

# BIP151RekeyTest
bin_PROGRAMS += gtest/BIP151RekeyTest
gtest_BIP151RekeyTest_SOURCES = gtest/BIP151RekeyTest.cpp
gtest_BIP151RekeyTest_CXXFLAGS = $(AM_CXXFLAGS)
gtest_BIP151RekeyTest_CPPFLAGS = $(AM_CPPFLAGS) $(INCLUDE_FILES)
gtest_BIP151RekeyTest_LDADD = gtest/libgtest.la $(LIBBTC) $(LIBCRYPTOPP) \
			$(LIBCHACHA20POLY1305)
gtest_BIP151RekeyTest_LDFLAGS = $(AM_LDFLAGS) $(LDFLAGS) -static
TESTS += gtest/BIP151RekeyTest

# SupernodeTests
bin_PROGRAMS += gtest/SupernodeTests
gtest_SupernodeTests_SOURCES = gtest/SupernodeTests.cpp
gtest_SupernodeTests_CXXFLAGS = $(AM_CXXFLAGS) $(LIBBTC_FLAGS)
gtest_SupernodeTests_CPPFLAGS = $(AM_CPPFLAGS) $(INCLUDE_FILES) -DUNIT_TESTS
gtest_SupernodeTests_LDADD = gtest/libgtest.la \
			$(LIBARMORYCOMMON) \
			$(LIBARMORYCLI) \
			$(LIBCRYPTOPP) \
			$(LIBLMDB) \
			$(LIBBTC) \
			-lprotobuf
gtest_SupernodeTests_LDFLAGS = $(AM_LDFLAGS) $(LWSLDFLAGS) $(LDFLAGS) -static
TESTS += gtest/SupernodeTests

# CppBlockUtilsTests - Contains the bulk of the tests
bin_PROGRAMS += gtest/CppBlockUtilsTests
gtest_CppBlockUtilsTests_SOURCES = gtest/CppBlockUtilsTests.cpp
gtest_CppBlockUtilsTests_CXXFLAGS = $(AM_CXXFLAGS) $(LIBBTC_FLAGS)
gtest_CppBlockUtilsTests_CPPFLAGS = $(AM_CPPFLAGS) $(INCLUDE_FILES)
gtest_CppBlockUtilsTests_LDADD = gtest/libgtest.la \
			$(LIBARMORYCOMMON) \
			$(LIBCHACHA20POLY1305) \
			$(LIBARMORYCLI) \
			$(LIBCRYPTOPP) \
			$(LIBBTC) \
			$(LIBLMDB) \
			-lprotobuf
gtest_CppBlockUtilsTests_LDFLAGS = $(AM_LDFLAGS) $(LWSLDFLAGS) $(LDFLAGS) -static
TESTS += gtest/CppBlockUtilsTests

# WalletTests
bin_PROGRAMS += gtest/WalletTests
gtest_WalletTests_SOURCES = gtest/WalletTests.cpp
gtest_WalletTests_CXXFLAGS = $(AM_CXXFLAGS) $(LIBBTC_FLAGS)
gtest_WalletTests_CPPFLAGS = $(AM_CPPFLAGS) $(INCLUDE_FILES) -DUNIT_TESTS
gtest_WalletTests_LDADD = gtest/libgtest.la \
			$(LIBBTC) \
			$(LIBARMORYCOMMON) \
			$(LIBARMORYCLI) \
			$(LIBCRYPTOPP) \
			$(LIBBTC) \
			$(LIBLMDB) \
			-lprotobuf
gtest_WalletTests_LDFLAGS = $(AM_LDFLAGS) $(LWSLDFLAGS) $(LDFLAGS) -static
TESTS += gtest/WalletTests
